<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="DebugDiag.Analysis.AnalysisRuleListControl" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:cm="clr-namespace:System.ComponentModel;assembly=WindowsBase">
  <FrameworkElement.Resources>
    <ResourceDictionary>
      <CollectionViewSource x:Key="myCVS" Source="{Binding Rules}">
        <CollectionViewSource.GroupDescriptions>
          <PropertyGroupDescription PropertyName="AnalysisRuleInfo.Category" />
        </CollectionViewSource.GroupDescriptions>
        <CollectionViewSource.SortDescriptions>
          <cm:SortDescription PropertyName="RuleTypeSortOrder" />
          <cm:SortDescription PropertyName="RuleCategorySortOrder" />
          <cm:SortDescription PropertyName="DisplayName" />
        </CollectionViewSource.SortDescriptions>
      </CollectionViewSource>
    </ResourceDictionary>
  </FrameworkElement.Resources>
  <Grid>
    <ListView Grid.Row="1" SelectionMode="Multiple" ItemsSource="{Binding Source={StaticResource myCVS}}">
      <ItemsControl.ItemContainerStyle>
        <Style TargetType="{x:Type ListViewItem}">
          <Setter Property="AutomationProperties.Name" Value="{Binding DisplayName}" />
          <Setter Property="AutomationProperties.HelpText" Value="{Binding ToolTip}" />
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="{x:Type ListViewItem}">
                <GridViewRowPresenter />
              </ControlTemplate>
            </Setter.Value>
          </Setter>
          <EventSetter Event="MouseDoubleClick" Handler="RuleDoubleClick" />
        </Style>
      </ItemsControl.ItemContainerStyle>
      <ItemsControl.GroupStyle>
        <GroupStyle>
          <GroupStyle.ContainerStyle>
            <Style TargetType="{x:Type GroupItem}">
              <Setter Property="Margin" Value="0,0,0,5" />
              <Setter Property="AutomationProperties.Name" Value="{Binding Name}" />
              <Setter Property="AutomationProperties.HelpText" Value="{Binding Name}" />
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="{x:Type GroupItem}">
                    <Expander IsExpanded="True" BorderBrush="#FFA4B97F" BorderThickness="0,0,0,1">
                      <HeaderedContentControl.Header>
                        <CheckBox FontWeight="Bold" Margin="5,0,0,0" Content="{Binding Name}" Tag="{Binding Name}" Checked="RuleGroupCheckBox_CheckedChanged" Unchecked="RuleGroupCheckBox_CheckedChanged" />
                      </HeaderedContentControl.Header>
                      <ContentControl.Content>
                        <ItemsPresenter />
                      </ContentControl.Content>
                    </Expander>
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
            </Style>
          </GroupStyle.ContainerStyle>
        </GroupStyle>
      </ItemsControl.GroupStyle>
      <ListView.View>
        <GridView>
          <GridViewColumn Width="300" Header="Rule Name">
            <GridViewColumn.CellTemplate>
              <DataTemplate>
                <Grid Margin="35,0,0,0" Width="315" HorizontalAlignment="Stretch">
                  <StackPanel Orientation="Horizontal">
                    <Image Height="16" Width="16" Source="{Binding RuleIcon}" />
                    <CheckBox HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" FontWeight="Bold" FontSize="12" Foreground="{StaticResource PrimaryDataFontBrush}" IsChecked="{Binding IsSelected}" Content="{Binding DisplayName}" ToolTip="{Binding ToolTip}" />
                  </StackPanel>
                </Grid>
              </DataTemplate>
            </GridViewColumn.CellTemplate>
          </GridViewColumn>
          <GridViewColumn Width="650" Header="Description">
            <GridViewColumn.CellTemplate>
              <DataTemplate>
                <TextBlock FontWeight="{Binding FontWeight}" Foreground="{Binding Foreground}" Text="{Binding AnalysisRuleInfo.Description}" />
              </DataTemplate>
            </GridViewColumn.CellTemplate>
          </GridViewColumn>
          <GridViewColumn Width="600" Header="Path">
            <GridViewColumn.CellTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding AnalysisRuleInfo.Location}" />
              </DataTemplate>
            </GridViewColumn.CellTemplate>
          </GridViewColumn>
        </GridView>
      </ListView.View>
    </ListView>
  </Grid>
</UserControl>